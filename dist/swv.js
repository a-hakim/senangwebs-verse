!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SWV=e():t.SWV=e()}(this,()=>(AFRAME.registerComponent("data-swv-player",{schema:{cameraRig:{type:"selector",default:"#camera-rig"},playerModel:{type:"selector",default:"#player-model-entity"},animWalking:{type:"string",default:"walking"},animIdle:{type:"string",default:"idle"},speed:{type:"number",default:5},crouchSpeed:{type:"number",default:2.5},jumpForce:{type:"number",default:8},gravity:{type:"number",default:-19.6},playerHeight:{type:"number",default:1.8},crouchHeight:{type:"number",default:1}},init:function(){this.el.object3D.position.set(0,this.data.playerHeight/2,0),this.velocity=new THREE.Vector3,this.direction=new THREE.Vector3,this.keys={},this.isJumping=!1,this.isCrouching=!1,this.forwardVector=new THREE.Vector3,this.rightVector=new THREE.Vector3,this.moveVector=new THREE.Vector3,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.data.playerModel&&this.data.playerModel.setAttribute("animation-mixer",{clip:"CharacterArmature|Idle",loop:"repeat"})},tick:function(t,e){var i=this.data,o=e/1e3;this.el.object3D.position.y>0||this.velocity.y>0?(this.velocity.y+=i.gravity*o,this.isJumping=!0):(this.velocity.y=0,this.el.object3D.position.y=0,this.isJumping=!1),this.direction.set(0,0,0);var a=this.isCrouching?i.crouchSpeed:i.speed;if(this.keys.w&&(this.direction.z=-1),this.keys.s&&(this.direction.z=1),this.keys.a&&(this.direction.x=-1),this.keys.d&&(this.direction.x=1),this.data.playerModel){var s=this.data.playerModel.object3D;if(this.direction.lengthSq()>0){this.data.playerModel.setAttribute("animation-mixer",{clip:this.data.animWalking,loop:"repeat"});var r=i.cameraRig.object3D.rotation.y,n=new THREE.Vector3(this.direction.x,0,this.direction.z).normalize();if(n.lengthSq()>0){var h=r+Math.atan2(n.x,n.z);s.rotation.y+=.2*((h-s.rotation.y+3*Math.PI)%(2*Math.PI)-Math.PI)}}else this.data.playerModel.setAttribute("animation-mixer",{clip:this.data.animIdle,loop:"repeat"})}if(this.direction.lengthSq()>0){this.direction.normalize();var c=i.cameraRig.object3D.rotation.y;this.forwardVector.set(0,0,-1).applyAxisAngle(new THREE.Vector3(0,1,0),c),this.rightVector.set(1,0,0).applyAxisAngle(new THREE.Vector3(0,1,0),c);var l=this.forwardVector.multiplyScalar(-this.direction.z),d=this.rightVector.multiplyScalar(this.direction.x);this.moveVector.copy(l.add(d)).normalize().multiplyScalar(a),this.velocity.x=this.moveVector.x,this.velocity.z=this.moveVector.z}else this.velocity.x=0,this.velocity.z=0;this.el.object3D.position.addScaledVector(this.velocity,o),i.cameraRig.object3D.position.copy(this.el.object3D.position)},onKeyDown:function(t){var e=t.key.toLowerCase();this.keys[e]=!0,"Space"!==t.code||this.isJumping||this.isCrouching||(this.velocity.y=this.data.jumpForce),"c"!==e||this.isCrouching||this.isJumping||(this.isCrouching=!0,this.data.playerModel&&this.data.playerModel.setAttribute("animation",{property:"scale",to:"1 ".concat(this.data.crouchHeight/this.data.playerHeight," 1"),dur:200,easing:"easeOutQuad"}))},onKeyUp:function(t){var e=t.key.toLowerCase();this.keys[e]=!1,"c"===e&&(this.isCrouching=!1,this.data.playerModel&&this.data.playerModel.setAttribute("animation",{property:"scale",to:"1 1 1",dur:200,easing:"easeOutQuad"}))},remove:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}}),{}));